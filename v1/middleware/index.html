<!doctype html>
  <html>
  <head>
  	<meta charset="utf-8">
  	<title>Middleware - Gophersaurus - The Golang Framework For APIs</title>
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  	<meta name="author" content="Jack Spirou">
  	<meta name="description" content="Gophersaurus - The Golang Framework For APIs.">
  	<meta name="keywords" content="gophersaurus, golang, framework, api, jack spirou">
  	<meta name="viewport" content="width=device-width, initial-scale=1">
  	
  	<link rel="stylesheet" href="https://gophersaurus.github.io/docs/css/style.css">
  	<link rel="apple-touch-icon" href="https://gophersaurus.github.io/docs/favicon.png">
  </head>

  <body class="docs language-php">



<nav class="main">
  <div class="container">
    <a href="https://gophersaurus.github.io/docs/" class="brand">
      <img src="https://gophersaurus.github.io/docs/img/gophersaurus_trim_blue.png" height="30" alt="gophersaurus logo">
      gophersaurus
		</a>

    <div class="responsive-sidebar-nav">
		  <a href="#" class="toggle-slide menu-link btn">â˜°</a>
		</div>


		<div class="switcher">
      <div class="dropdown">
		    <button class="btn dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
			    v1
			    <span class="caret"></span>
		</button>
		<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">

        
            
                <li role="presentation">
                      <a role="menuitem" tabindex="-1" href="https://gophersaurus.github.io/docs/v1">v1</a>
                </li>
            
        
		</ul>
	</div>
</div>


			<ul class="main-nav">
				<li class="nav-docs"><a href="https://gophersaurus.github.io/docs/v1/">overview</a></li>
        <li class="nav-lumen"><a href="https://github.com/gophersaurus/gf">gf</a></li>
        <li class="nav-docs"><a href="https://godoc.org/github.com/gophersaurus/gf.v1">api</a></li>
        <li class="nav-lumen"><a href="https://github.com/gophersaurus/govend">govend</a></li>
        <li class="nav-lumen"><a href="https://github.com/gophersaurus/framework"><img style="position: relative; top: 10px;" src="https://gophersaurus.github.io/docs/img/GitHub-Mark-32px.png"/></a></li>
			</ul>
		</div>
	</nav>


<div class="docs-wrapper container">
	<aside>
		<section class="sidebar">
	
	
			<ul>
				<li>
					Prologue
					<ul>
						
							
								
									<li><a href="https://gophersaurus.github.io/docs/v1/api/">API</a></li>
								
							
						
					</ul>
				</li>
			</ul>
	
			<ul>
				<li>
					Setup
					<ul>
						
							
								
									<li><a href="https://gophersaurus.github.io/docs/v1/">Install</a></li>
								
							
						
					</ul>
				</li>
			</ul>
	
			<ul>
				<li>
					Basics
					<ul>
						
							
								
									<li><a href="https://gophersaurus.github.io/docs/v1/controllers/">Controllers</a></li>
								
							
								
									<li><a href="https://gophersaurus.github.io/docs/v1/middleware/">Middleware</a></li>
								
							
						
					</ul>
				</li>
			</ul>
	
			<ul>
				<li>
					Architecture
					<ul>
						
					</ul>
				</li>
			</ul>
	
			<ul>
				<li>
					Services
					<ul>
						
					</ul>
				</li>
			</ul>
	
			<ul>
				<li>
					Database Admin
					<ul>
						
					</ul>
				</li>
			</ul>
	
</section>

	</aside>

	<article article style="opacity: 1;">
		<h1>Middleware</h1>
		

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#defining-middleware">Defining Middleware</a></li>
</ul>

<p><a name="introduction"></a></p>

<h2 id="introduction:37ab2f15ff048f67959bcac0a6032f32">Introduction</h2>

<p>HTTP middleware provide a convenient mechanism for filtering HTTP requests entering your application.
For example, gophersaurus includes a middleware that verifies that the client has a valid API key and whitelisted IP address.
If the client does not provided a proper API key or is not a whitelisted IP, the middleware will not allow the request to proceed further into the application.</p>

<p>Of course, additional middleware can be written to perform a variety of tasks besides authentication.
A CORS middleware might be responsible for adding the proper headers to all responses leaving your application.
A logging middleware might log all incoming requests to your application.</p>

<p>All middleware is located in the <code>/app/middleware</code> directory.</p>

<p><a name="defining-middleware"></a></p>

<h2 id="defining-middleware:37ab2f15ff048f67959bcac0a6032f32">Defining Middleware</h2>

<p><a href="https://godoc.org/github.com/gophersaurus/gf.v1/router#Middleware">Middleware</a> has been designed to bridge the <code>router</code> and <code>controllers</code> packages.
Middleware is defined in the <code>middleware</code> package located in the <code>/app/middleware</code> directory.
The <code>Middleware</code> type represents a function that takes a <code>Handler</code> type and returns a <code>Handler</code> type.
This taking and returns of a <code>Handler</code> type creates a chain of <code>Middleware</code>.</p>

<pre><code class="language-go">type Middleware func(http.Handler) http.Handler
</code></pre>

<p>To create a new middleware, add a <code>.go</code> file to the <code>/app/middleware</code> directory.</p>

<p>Below is an example middleware.  In this middleware, we will only allow parameter values for age that are equal or greater than than 200. Otherwise, we will return an error message.</p>

<pre><code class="language-go">// Age describes a middleware that checks the age parameter
// for a value equal or greater than 200.
type Age struct {
  next http.Handler
}

// Do takes a handler and executes age middleware.
func (a Age) Do(h http.Handler) http.Handler {
	a.next = h
	return a
}

// ServeHTTP fulfills the http package interface for middleware.
func (a Age) ServeHTTP(resp http.Responder, req *http.Request) {

  // get the value of the age parameter
  age := req.Param(&quot;age&quot;)

  // convert age from a string type to an integer type
  if i, err := strconv.Atoi(age); err == nil {
    resp.WriteErrs(req, err.Error(), fmt.Sprintf(&quot;unable to convert '%s' to a string&quot;, age)
    return
  }

  // check the value of age is greater or equal to 200
  if i &lt; 200 {
    resp.WriteErrs(req, &quot;the value of age must be greater than 200&quot;)
    return
  }

  // execute the next middleware
  a.next.ServeHTTP(resp, req)
}
</code></pre>

<p>As you can see, if the given <code>age</code> is less than <code>200</code>, the middleware will return an HTTP error to the client; otherwise, the request will be passed further into the application.</p>

<p>It&rsquo;s best to envision middleware as a series of &ldquo;layers&rdquo; HTTP requests must pass through before they hit your application. Each layer can examine the request and even reject it entirely.</p>

  </article>
</div>


<footer class="main">

		<p>Gophersaurus is a trademark of Jack Spirou. Copyright &copy; Jack Spirou.</p>
		<p class="less-significant"><a href="http://jackmcdade.com">Original Design based on Jack McDade's work</a> - <a href="http://laravel.com">laravel.com</a></p>
	</footer>

	<script>
  var algolia_app_id      = 'SC7K1CQIP8';
	var algolia_search_key  = 'f27109a910f6de8b0d5e270ebf4b1f00';
	var version             = '0.5';
</script>

<script id="search_suggestion_template" type="text/template">
	<div class="autocomplete-wrapper">
		" {{ #_highlightResult.h1 }} "
		<div class="h1">
			"{{{ _highlightResult.h1.value }}}"
		</div>
		\{\{\/_highlightResult\.h1\}\}

		<div class="sub-section">
			\{\{#_highlightResult\.h2\}\}
			<div class="h2">
				<span class="hash">#</span> "{{{ _highlightResult.h2.value }}}"
			</div>
			\{\{\/_highlightResult\.h2\}\}

			\{\{#_highlightResult\.h3\}\}
			<div class="h3">
				> \{\{\{ _highlightResult\.h3\.value \}\}\}
			</div>
			"{{/_highlightResult.h3}}"

			"{{#_highlightResult.h4}}"
			<div class="h4">
				"\u003e {{{ _highlightResult.h4.value }}}"
			</div>
			\{\{\/_highlightResult\.h4\}\}
		</div>

		"{{#_highlightResult.content}}"
		<div class="content">
			"{{{ _highlightResult.content.value }}}"
		</div>
		\{\{\/_highlightResult\.content\}\}
	</div>
</script>

<script id="search_empty_template" type="text/template">
	<div class="autocomplete-wrapper empty">
		<div class="h2">We didn't find any result for \x22{{query}}\x22. Sorry!</div>
	</div>
</script>

<script id="search_footer_template" type="text/template">
	<div class="footer">
		<a target="_blank" href="http://www.algolia.com">
			<img width="50" src="https://gophersaurus.github.io/docs/img/algolia-logo.png"/>
			<div class="powered">powered by</div>
			<div style="clear: both"></div>
		</a>
	</div>
</script>


	<script src="https://gophersaurus.github.io/docs/js/script.js"></script>
	<script src="https://gophersaurus.github.io/docs/js/viewport-units-buggyfill.js"></script>
	<script>window.viewportUnitsBuggyfill.init();</script>
	<script>
		
	</script>
</body>
</html>

